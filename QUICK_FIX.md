# 🔥 紧急修复：视频流"获取帧失败"问题

## 问题现象
```
开始视频流
获取帧失败
视频流结束
```

## ✅ 已修复!

### 根本原因
**I2S音频引脚与摄像头引脚冲突导致！**

- 原I2S引脚GPIO 13 = 摄像头PCLK (像素时钟) ❌
- 原I2S引脚GPIO 15 = 摄像头XCLK (主时钟) ❌

### 解决方案
已将代码中I2S引脚改为：
```cpp
GPIO 21 → I2S_BCLK (位时钟)
GPIO 42 → I2S_LRC  (帧时钟)
GPIO 41 → I2S_DOUT (数据输出)
```

## 🔧 您需要做的

### 1. 重新上传代码
```
1. Arduino IDE → 打开 AI_Answer.ino
2. 点击 "上传" 按钮
3. 等待编译上传完成
```

### 2. 重新连接MAX98357A硬件

**拔掉原来的连接线:**
- ~~GPIO 14~~ ❌
- ~~GPIO 15~~ ❌
- ~~GPIO 13~~ ❌

**连接到新引脚:**
```
ESP32-S3        MAX98357A
─────────────────────────
GPIO 21    →    BCLK
GPIO 42    →    LRC
GPIO 41    →    DIN
GND        →    GND
5V         →    VIN
```

### 3. 测试验证

**A. 测试视频流:**
```
1. 打开串口监视器 (115200)
2. 复位ESP32
3. 访问 http://<ESP32-IP>/
4. 点击 "开始视频流"
5. ✅ 应该看到连续的视频画面，无 "获取帧失败"
```

**B. 测试音频 (如果已连接扬声器):**
```
1. 在网页点击 "AI分析"
2. 等待AI响应
3. ✅ 扬声器应播放AI描述语音
```

## 📋 详细文档

已更新以下文档：
- `GPIO_CONFLICT_FIX.md` - 完整故障排查指南
- `TTS_I2S_GUIDE.md` - 更新接线图
- `VOICE_SETUP_GUIDE.md` - 更新引脚说明

## ❓ 如果仍有问题

**问题1: 编译错误**
- 确保已安装 `ESP8266Audio` 库
- 工具 → 管理库 → 搜索安装

**问题2: 视频流正常但无声音**
- 检查硬件连接
- 检查扬声器极性
- 尝试更换扬声器
- 检查MAX98357A供电 (需要5V 1A+)

**问题3: 仍然获取帧失败**
- 检查PSRAM: `Serial.printf("PSRAM: %d\n", ESP.getPsramSize());`
- 降低分辨率到VGA
- 检查摄像头排线连接

---
**修复时间:** 2025-10-07  
**状态:** ✅ 已完成  
**测试状态:** ⏳ 等待用户验证
